<%
  has_product = page.products.to_a.count > 0
%>

<article id="s<%= page.handle.to_s.split('/').first %>" class="page
 <%= page.layout.type || 'two-column' %>
 <%= 'no-image ' unless page.image_url %>
 <%= 'has-product ' if has_product %>
 <%= 'no-header ' unless page.title || page.description %>
 <%= 'no-content ' unless page.content %>
 <%= page.content_type %>

 <% if page.layout.type != "custom" %>
   <%= page.layout.content_overflow || 'scroll' %>
   <%= page.layout.content_style || 'white' %>
   <%= page.layout.content_align || 'left' %>
   <%= page.layout.content_valign || 'top' %>

   <%= "height-#{page.layout.content_height || 'auto'}" %>
   <%= "image-#{page.layout.image_style}" if page.layout.image_style %>
   <%= "cover-#{page.layout.image_align}" if has_product || page.layout.image_align && page.image_url %>
 <% end %>"

 <% if page.layout.image_style == 'background' %>
  style="background-image: url(<%= page.image_url %>)"
 <% end %>

 <% if page.handle %>
  data-page="<%= page.handle %>"
 <% end %>
>

<% unless page.layout.type == "custom" %>

  <% if page.image_url %>
  <div class="cover-area <%= page.layout.image_style %>"
    style="background-image: url(<%= page.image_url if page.layout.image_style != "background" %>)">
    <% if video_embed = page.embed_content %>
      <div class='video-wrapper'><%= video_embed %></div>
    <% end %>
    <% if page.cover_content %>
      <div class="cover-content"><%= page.cover_content %></div>
    <% end %>
  </div>
  <% end %>

  <div class='content'>
    <% if page.title || page.description %>
    <header>
      <% if page.category %>
        <span class='category'><%= page.category %></span>
      <% end %>

      <% if page.title %>
      <h1 class='title preview_item_title'><%= page.title %></h1>
      <% end %>

      <% if page.subtitle %>
        <h3 class='subtitle'><%= page.subtitle %></h3>
      <% end %>

      <div class='extras'>
        <% if page.author_icon %>
          <img src="<%= page.author_icon %>" class='avatar' >
        <% end %>

        <% if page.byline %>
          <em><%= page.byline %></em>
        <% end %>

        <% if page.description %>
          <p class="description"><%= page.description %></p>
        <% end %>
      </div>
    </header>
    <% end %>

    <% if has_product %>
      <ul class="<%= "cover-area" unless page.image_url %> product-set <%= "set-#{(page.products.to_a.count/2.0).ceil*2}" %>">
      <% page.products.each_with_index do |product, index| %>
        <li>
          <a href="<%= product[:url] %>" class='hotspot product' data-track="hotspot:click" title="<%= product.title %>">
            <img src="<%= product[:image_url] %>" alt=''>
            <span class='tag'><%= index + 1 %></span>
          </a>
        </li>
      <% end %>
      </ul>
    <% end %>

    <% if page.image_url || has_product %>
      <p class='column-break'></p>
    <% end %>

    <% if page.layout.type == 'three-column' && page.image_url %>
      <p class='column-break'></p>
    <% end %>

    <div class='body'><%= page.content %></div>
  </div>
<% else %>

  <%= page.content %>

<% end %>

  <%#= render 'debug', locals: { page: page } %>
</article>

<% content_for :js do %>
<script>
  App = (typeof App == 'undefined') ? {} : App;

  App.page = {
    title: "<%= page.title %>",
    links: <%= page.links.to_json %>,
    products: <%= page.products.to_json %>
  }

  App.pageView = new PageView({ model: App.page })

</script>
<% end %>
