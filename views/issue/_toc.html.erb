<% header_area = capture do %>
<header>
  <% if page.category %>
    <span class="category"><%= page.category %></span>
  <% end %>

  <% if page.title %>
  <h1 class="title preview_item_title"><%= page.title %></h1>
  <% end %>

  <% if false && page.description %>
  <h3 class="subtitle description"><%= page.description %></h3>
  <% end %>

  <div class="extras">
    <% if page.author_icon %>
      <img src="<%= page.author_icon %>" class="avatar" >
    <% end %>

    <% if page.author_name %>
      <em>by <%= page.author_name %></em>
    <% end %>

    <% if page.description %>
      <p><%= page.description %></p>
    <% end %>
  </div>
</header>
<% end %>

<article id="toc_page" class="toc page"
  data-page-id=<%= page.id %>
>
  <div class="main col third-2">
    <div class="cover-area <%= page.layout.image_style %>" style="background-image: url(<%= page.image_url %>)">
      <% if video_embed = page.embed_content %>
        <div class="video-wrapper"><%= video_embed %></div>
      <% elsif page.brand_image_url %>
        <img class="brand-logo" src="<%= page.brand_image_url %>" alt="">
      <% end %>
    </div>

    <div class="content">
      <%= header_area %>
      <p class="column-break"></p>
      <div class="body"><%= page.content %></div>
    </div>
  </div>

  <div class="menu col third">
    <div class="head">
      <h2>CONTENTS</h2>
      <hr />
    </div>
    <ul>
      <% issue.items.each do |page| %>
        <% if page.nav != false && page.handle != "toc" %>
        <li>
          <a class="toc" href="<%= page.url %>">
            <span class="category"><%= page.category %></span>
            <span class="story"><%= page.title %></span>
            <span class="author"><%= "By #{page.author_name}" if page.author_name %></span>
          </a>
        </li>
        <% end %>
      <% end %>
    </ul>
  </div>
</article>
<% content_for :js do %>
<script>
  App = (typeof App == 'undefined') ? {} : App;

  App.page = {
    title: "<%= page.title %>",
    links: <%= page.links.to_json %>,
    products: <%= page.products.to_json %>
  }

  <% unless request.xhr? %>
    App.pageView = new PageView({ model: App.page })
  <% end %>
  // App.trigger('track', 'view')
  
</script>
<% end %>