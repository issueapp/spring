<% header_area = capture do %>
<header>
  <% if page.category %>
    <span class="category"><%= page.category %></span>
  <% end %>

  <% if page.title %>
  <h1 class="title preview_item_title"><%= page.title %></h1>
  <% end %>

  <% if false && page.description %>
  <h3 class="subtitle description"><%= page.description %></h3>
  <% end %>

  <div class="extras">
    <% if page.author_icon %>
      <img src="<%= page.author_icon %>" class="avatar" >
    <% end %>

    <% if page.author_name %>
      <em>by <%= page.author_name %></em>
    <% end %>

    <% if page.description %>
      <p><%= page.description %></p>
    <% end %>
  </div>
</header>
<% end %>

<article id="toc_page" class="toc page

 <% if page.layout.type != "custom" %>
   <%= page.layout.content_overflow || 'scroll' %>
   <%= page.layout.content_style || 'white' %>
   <%= page.layout.content_align || 'left' %>
   <%= page.layout.content_valign || 'top' %>

   <%= "height-#{page.layout.content_height || 'auto'}" %>
   <%= "image-#{page.layout.image_style}" if page.layout.image_style %>
   <%= "cover-#{page.layout.image_align}" if page.layout.image_align && page.cover_url %>
 <% end %>"
 
  data-page-id="<%= page.id %>" 
  data-page="<%= page.handle + page_ext %>"
  data-theme="<%= page.theme %>"
>
  <div class="main col third-2">
    <div class="cover-area <%= page.layout.image_style %>" 
         style="background-image: url(<%= asset_path page.cover_url %>)">
      <% if video_embed = page.embed_content %>
        <div class="video-wrapper"><%= video_embed %></div>
      <% end %>
    </div>

    <div class="content">
      <%= header_area %>
      <p class="column-break"></p>
      <div class="body"><%= render_page page %></div>
    </div>
  </div>

  <div class="menu col third">
    <div class="head">
      <h2>CONTENTS</h2>
      <hr />
    </div>
    <ul>
      <% issue.pages.each do |page| %>
        <% if page.nav != false && page.handle != "toc" %>
        <li>
          <a class="toc" href="<%= page.url %>&?embed=1">
            <span class="category"><%= page.category %></span>
            <span class="story"><%= page.title %></span>
            <span class="author"><%= "By #{page.author_name}" if page.author_name %></span>
          </a>
        </li>
        <% end %>
      <% end %>
    </ul>
  </div>
</article>
<% content_for :js do %>
<script>
$(function () {
  App = (typeof App == 'undefined') ? {} : App;

  App.page = {
    title: "<%= page.title %>",
    links: <%= page.links.to_json %>,
    products: <%= page.products.to_json %>
  }

  <% unless request.xhr? %>
    App.currentView = new PageView({ path: "<%= page.handle + page_ext %>", model: App.page })
    App.currentView.render()
  <% end %>
})
</script>
<% end %>
