<style>
  html, body {
    overflow: hidden;
  }

  body {
    position: relative;
  }

  .swipe-paging {
    position: absolute;
    white-space: nowrap;
    overflow: hidden;
  }

  .animate {
    -webkit-transition: all .3s ease-out;
    -moz-transition: all .3s ease-out;
    -o-transition: all .3s ease-out;
    -ms-transition: all .3s ease-out;
    transition: all .3s ease-out;
  }

  .page {
    transform: translate3d(0,0,0);
    -webkit-transform:translate3d(0,0,0);
    position: relative;
    float: left;
    display: inline-block;
    margin: 0;
    padding: 5px;
    white-space: normal;
    overflow: hidden;
    border: 1px solid #fff;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
  }

  .page.current {
    visibility: visible;
  }

  .page.padding {
    width: 0;
  }

  .page {
    border: 1px solid red;
    background: #eee;
    /*width: 934px;*/
    /*height: 394px;*/
  }

  .k1, .k2, .k3, .k4, .k5, .k6, .k7 {
    background-size: cover;
  }

  .k1 {
    background-image: url(http://placekitten.com/1024/1021);
  }
  .k2 {
    background-image: url(http://placekitten.com/1024/1022);
  }
  .k3 {
    background-image: url(http://placekitten.com/1024/1023);
  }
  .k4 {
    background-image: url(http://placekitten.com/1024/1024);
  }
  .k5 {
    background-image: url(http://placekitten.com/1024/1025);
  }
  .k6 {
    background-image: url(http://placekitten.com/1024/1026);
  }
  .k7 {
    background-image: url(http://placekitten.com/1024/1011);
  }

  .toolbar {
    height: 50px;
  }

</style>

<div class="swipe-paging"></div>
<div id="gallery"></div>

<% content_for :js do %>
<script> App = {} </script>
<script src="/javascripts/views/swipe_view.js"></script>
<script src="/javascripts/views/gallery_view.js"></script>

<script type="text/javascript">

  var pageWidth = window.innerWidth
  var pageHeight = window.innerHeight - 50
  $('head').append('<style>.page { width:'+pageWidth+'; height:'+pageHeight+' }</style>');

  var page = "sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.";

  var galleryPage = ' \
    <div class="col half"> \
      <div class="gallery"> \
        <a href="http://placekitten.com/1024/1021"><img src="http://placehold.it/900x400" ></a> \
        <a href="http://placekitten.com/1024/1022"></a> \
        <a href="http://placekitten.com/1024/1023"></a> \
        <a href="http://placekitten.com/1024/1024"></a> \
        <a href="http://placekitten.com/1024/1025"></a> \
      </div> \
    </div>';

  var i = 0, pages = [], lastStep = 0;

  for (i = 0; i < 7; i++) {
    pages.push('<div class="col half"><h1>Page ' + i + " </h1> " + page + '</div>')
  }
  i = -1;

  var createPage = function (step) {
    if (i > 2 && i < 7 && step < 0 && lastStep > 0)
      i -= 3;
    else if (i > 2 && i == 7 && step < 0)
      i -= 4;
    else if (i == 0 && lastStep == -1)
      i += 3;
    else
      i = i + step;

    if (i < 0) i = -1;
    if (i > 6) i = 7;
    lastStep = step;

    return pages[i];
  };

  $('.swipe-paging').append('<div class="page">'+ createPage(+1)+'</div>')
  $('.swipe-paging').append('<div class="page next loading">Loading...</div>')

  var view = new App.SwipeView;

  // // Next page doesn't exist
  // view.on("fetch:next", function(view) {
  //   var loading = view.$('.loading');
  //   loading.html( createPage(+1) );
  //   loading.removeClass('loading');
  //   // loading.append(galleryPage);
  //   loading.append(' \
  //     <div class="col half"> \
  //       <div class="gallery"> \
  //         <a href="http://placehold.it/650x300"><img src="http://placehold.it/900x400" ></a> \
  //         <a href="http://placehold.it/600x300"></a> \
  //         <a href="http://placehold.it/550x300"></a> \
  //         <a href="http://placehold.it/500x300"></a> \
  //         <a href="http://placehold.it/450x300"></a> \
  //       </div> \
  //     </div>'
  //   );
  // })

  // Buffered page doesn't exist
  view.on("buffer:next", function(view) {
    var page = createPage(+1)
    if (page)
      $(view.el).append('<div class="page"><div class="col half">' + page + '</div></div>')
  })

  // Buffered page doesn't exist
  view.on("buffer:prev", function(view) {
    var page = createPage(-1)
    if (page)
      view.padding.after('<div class="page"><div class="col half">' + page + '</div></div>')
  })

  // Gallery View Start
  $('.page.current').append(galleryPage);

  var gallery = new App.GalleryView;

  $('.current.page .gallery a').live('click', function(e) {
    gallery.open();
    return false;
  });

</script>
<% end %>
